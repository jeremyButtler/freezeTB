freezeTb; detecting anti-microbal resistance in TB

@diagrams/yearlyDeaths.png
# Figure showing why TB is important (data from WHO 2023)
#  - 5 to 7 million sick per year from TB
#    - This is an cronic, multi year infection
#    - Opertunistic pathogen that requires an weakened
#      immune system to cause disease
#  - 10 million sick per year from TB
#  - 1 million deaths per year from TB

@diagrams/treatmentSuccesRate.png
# Figure showing the treament success rate for TB
#  Data from WHO 2023
#  - 85% success for non-drug resistant cases
#  - 63% success for drug resistant cases

#@diagrams/num2022AmrCases.png
# Figure showing the percentage of drug resistance cases
#  No longer used
#  - 3.3% of new cases (410000 people) per year have
#    antimicrobial resistance (WHO 2023)
#  - 17% of cases from reinfections (WHO 2023)

Drug resistant detection

@diagrams/cultureTime.png
# Figuring showing how long it takes to do an liqued TB
#   culture. The acutal figure shows an solid culture
#   of an Kriby Bower assay because, that is what most
#   people to in microbiology class
#   - Culture over 14 days (Campelo et al. 2021)

Rapid molecular diagnostic test; specific targets only
  - Campelo et al. 2021; Mukherjee et al. 2023

Sequencing; unspecific, but more expertise
  - Campelo et al. 2021; Mukherjee et al. 2023

@diagrams/sequencers.png
# Figuring showing an MiSeq for short read sequencing and
#   an Minion (ONT) for long read.
#
# Short read pros:
#  - Short read; higher capital (initial down) cost
#  - short read; accuracy is higher (Minimum Q30 = 99.9%)
#
# Short read cons:
#  - Short read; short 150bp long reads
#  - Short read; Not portable
#
# Long read cons:
#  - Long read; accuracy is lower (Q20 = 99%)
#
# Long read pros:
#  - Long read; low captial cost
#  - Long read; amplicon sized reads
#  - Long read; is very portable

freezeTb; the software side

Expected output

@diagrams/freezeTb-amrStep.png
# Figure showing we want to detect AMRs

@diagrams/lineage.png
# Figure showing we want lineage detection (surviellance)

2. a. MIRU-VNTR
   - Amplicons target 24 repeat regions across the genome
   - Amplicons lineage found by Length of amplicon
   - Current gold standard

2. b. Spoligotyping
   - Amplicon targets direct repeat region (1 primer)
   - Lineage found by detecting 43 internal spaces
   - Lineage id is barcode with presence/absence of spacer

@diagrams/consensus.png
# Figure showing that we want an consensus

TBProfiler; the current resource

TBProfiler; pros
  - Detects AMRs uses WHO's 2023 catalog
  - Detects spoligotypes and SNP lineages (Nanopore?)
  - Outputs an vcf files 

TBProfiler; cons
  - More focused on Illumina
  - > 5 dependencies or conda; not fun to install

Other solutions;

ONTs: Have not tried
  - Detects spoligotypes
  - Likely more to add

Plentaly of small programs that add in more dependencies

AMR detection; no small program I know of

Lineage detection is simple

Consensus building; non-model methods are simple

Most of it is simple, why not make our own?

FreezeTb; the software side
  - CLI; requires sam file
  - R GUI; fastq file only, but requires minimap2

@diagrams/freezeTb-filterStep.png
# Figure showing the filtering step (see comments beneath)
#
#1. Filter out reads with
#  - Mapping Quality < 15
#  - Median Q-score < 7
#  - Mean Q-score < 7
#  - Under 200 bases
#
#2. Make read depth reports with filtered and unfilterd
#   reads

@diagrams/consensus.png
# Figure showing I am moving to consensus bulding slide

Filters out bases with Q-scores under 7

Break up consensuses
  - Fragments assemblies under 20x read depth
  - Remove fragments less than 200 bases long

Masking:
  - Select nucleotides with most support
  - Mask nucleotides with less than 50% of mapped reads

Indel removal:
  - Remove indels with less than 70% of mapped reads

Ouput and sam file

@diagrams/freezeTb-amrStep.png
# Figure to show that I am moving to AMR detection slide

Using 2023 WHO tuberculosis AMR mutation catalog

Gene deletions are ignored

Frames shifts / LoF's treated as normal AMR
  - Less false positives due to indel errors

For amino acid catalog variants
  - AMR region in read converted to amino acids

AMR called if
  - Sequences match
  - Read AMR region length = catalog AMR length

@diagrams/lineage.png
# Figure to show I am moving to the lineage slides

Miru lineages:
  - See if read has primer coordinates (from sam file)
  - Check reads repeat length

Spoligotyping:
  - Get direct repeat (DR) region from consensus
  - Map spacer sequences to DR with Waterman alignment
  - Make barcode from mapped spacers and find lineage

@diagrams/freezeTb-diagram.png
# Figure shows the full pipeline
#  - It shows that we are doing each step, except
#    spoligotyping both the consensus and reads

Each step in freezeTb is modular:
  - You like an module; you can get an module
  - Each module takes an sam file

FreezeTb; works, but not an replacement

Future steps:
  - Finish and integrate spoligotyping
  - Maybe add in fast kmer seeding for spoligotyping

Fast kmer seeding is close to an read mapper

Why not add an read mapper? Ok probrably not.

?

# These are more of notes. I need to filter though this
#   and decide what to keep an what to remove
#
# ONT price
#  Xia, Yu, Xiang Li, Ziqi Wu, Cailong Nie, Zhanwen Cheng,
#    Yuhong Sun, Lei Liu, and Tong Zhang. 2023.
#    “ Strategies and tools in illumina and
#    nanopore-integrated metagenomic analysis of
#    microbiome data.” iMeta, 2, e72.
#    https://doi.org/10.1002/imt2.72
#
#Why Tuberculosis matters  (Global tuberculosis report 2023)
#- Worlds second leading cause of death for an single infectious agent
#- In 2019 13th highest cause of death of top 20 deaths (Fi. 8)
#- Causes 1.3 million deaths per year 
#- 10 million people sick/year
#- 5 to 7 million infections per year
# This is different from sickness
#- Untreated fatality of 50%
#- Treatment can cure 85% of people
#- 410000 people developed multi drug/rifampicin tuberculosis resistance
#
#
#
#Campelo TA, Cardoso de Sousa PR, Nogueira LL, Frota CC,
#   Zuquim Antas PR. Revisiting the methods for detecting
#   Mycobacterium tuberculosis: what has the new millennium
#   brought thus far?
#   Access Microbiol. 2021 Aug 2;3(8):000245.
#   doi: 10.1099/acmi.0.000245.
#   Erratum in: Access Microbiol. 2022 Jan 12;4(1):000294.
#   PMID: 34595396; PMCID: PMC8479963.
#- cell division 18-20 hours (slow), several weeks to see
#  visible colonies (solid culture media).
#- Also lists several methods
#
#Chowdhury K, Ahmad R, Sinha S, Dutta S,  Haque M.
#  Multidrug-Resistant TB (MDR-TB) and Extensively
#  Drug-Resistant TB (XDR-TB) Among Children: Where We
#  Stand Now. Cureus. 2023 Feb 18;15(2):e35154.
#  doi: 10.7759/cureus.35154. PMID: 36819973;
#  PMCID: PMC9938784.
#- fatal clinical outcomes 24% to 7% with drugs
#- first line drugs are less effective
#
#Mukherjee S, Perveen S, Negi A, Sharma R.
#   Evolution of tuberculosis diagnostics: From molecular
#   strategies to nanodiagnostics.
#   Tuberculosis (Edinb). 2023 May;140:102340.
#   doi: 10.1016/j.tube.2023.102340. Epub 2023 Apr 5.
#   PMID: 37031646; PMCID: PMC10072981.
#- This has a really good section on AMR detection methods
#- PCR/non-sequencing nucleotides methods are limited to known, common targets
#
#Vasiliu A, Saktiawati AMI, Duarte R, Lange C, Cirillo DM.
#  Implementing molecular tuberculosis diagnostic methods
#  in limited-resource and high-burden countries.
#  Breathe (Sheff). 2022 Dec;18(4):220226.
#  doi: 10.1183/20734735.0226-2022. Epub 2023 Feb 14.
#  PMID: 36865933; PMCID: PMC9973455.
#- This has some comparisons and limitations. Table 1 is
#  messy, but is really good.
#- It also includes some cost issues, such as commercial
#  software.
#
#Doyle RM, Burgess C, Williams R, Gorton R, Booth H, Brown J, Bryant JM, Chan J, Creer D, Holdstock J, Kunst H, Lozewicz S, Platt G, Romero EY, Speight G, Tiberi S, Abubakar I, Lipman M, McHugh TD, Breuer J. Direct Whole-Genome Sequencing of Sputum Accurately Identifies Drug-Resistant Mycobacterium tuberculosis Faster than MGIT Culture Sequencing. J Clin Microbiol. 2018 Jul 26;56(8):e00666-18. doi: 10.1128/JCM.00666-18. PMID: 29848567; PMCID: PMC6062781.
#- whole genome sequencing using baits
#
#Castillos de Ibrahim das Neves Y, Reis AJ, Xavier Maio N, Vianna J, Perdigão J, Bastos Ramis I, Almeida da Silva PE, Von Groll A. Genotyping methods and their contributions to the study of tuberculosis dynamic in Latin America. J Infect Dev Ctries. 2023 Nov 12;17(10):1373-1386. doi: 10.3855/jidc.17840. PMID: 37956372.
#  - Metanalysis of who is using what lineage. Good for
#    delving into lineage methods.
#  - MIRU is not spoligotyping
# Notes on sent commands
# Image: @file.png
#
# List:
#  - item 1
#  - item 2
#
# Empty lines break into new slides (end of paragraph)
#
# Make a blank slide with: \ 
# Escape '#', '@', and '\' with: \

#   Global tuberculosis report 2023
# https://www.who.int/publications-detail-redirect/9789240083851
